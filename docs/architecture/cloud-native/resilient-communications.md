---
title: Comunicación resistente
description: Diseño de aplicaciones .NET nativas en la nube para Azure | Comunicación resistente
ms.date: 06/30/2019
ms.openlocfilehash: 324f5426af1c892db73aa6fc2336a19b7a8e499e
ms.sourcegitcommit: 628e8147ca10187488e6407dab4c4e6ebe0cac47
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/15/2019
ms.locfileid: "73841226"
---
# <a name="resilient-communications"></a><span data-ttu-id="693ba-103">Comunicaciones resistentes</span><span class="sxs-lookup"><span data-stu-id="693ba-103">Resilient communications</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="693ba-104">A lo largo de este libro, hemos distribuido las ventajas de moverse más allá del diseño de aplicaciones monolíticas tradicional y de adoptar una arquitectura basada en microservicios donde un conjunto de servicios independientes distribuidos se ejecuten de forma independiente y se comuniquen con cada uno otros mediante protocolos de comunicación estándar como HTTP y HTTPS.</span><span class="sxs-lookup"><span data-stu-id="693ba-104">Throughout this book, we've evangelized the merits of moving beyond traditional monolithic application design and embracing a microservice-based architecture where a set of distributed, self-contained services run independently and communicate with each other using standard communication protocols such as HTTP and HTTPS.</span></span> <span data-ttu-id="693ba-105">Aunque este tipo de arquitectura le adquiere muchas ventajas importantes, también presenta muchos desafíos.</span><span class="sxs-lookup"><span data-stu-id="693ba-105">While such an architecture buys you many important benefits, it also presents many challenges.</span></span> <span data-ttu-id="693ba-106">Considere, por ejemplo, los siguientes aspectos:</span><span class="sxs-lookup"><span data-stu-id="693ba-106">Consider, for example, the following concerns:</span></span>

- <span data-ttu-id="693ba-107">*Comunicación de red fuera de proceso.*</span><span class="sxs-lookup"><span data-stu-id="693ba-107">*Out-of-process network communication.*</span></span> <span data-ttu-id="693ba-108">Cada servicio se comunica a través de un protocolo de red que presenta la congestión de la red, la latencia y los errores transitorios.</span><span class="sxs-lookup"><span data-stu-id="693ba-108">Each service communicates over a network protocol that introduces network congestion, latency, and transient faults.</span></span>
- <span data-ttu-id="693ba-109">*Detección de servicios.*</span><span class="sxs-lookup"><span data-stu-id="693ba-109">*Service discovery.*</span></span> <span data-ttu-id="693ba-110">Con cada servicio que se ejecuta en un clúster de máquinas con su propia dirección IP y puerto, ¿cómo se detectan y se comunican entre sí los servicios?</span><span class="sxs-lookup"><span data-stu-id="693ba-110">With each service running across a cluster of machines with its own IP address and port, how do services discover and communicate with each other?</span></span>
- <span data-ttu-id="693ba-111">*Resistencia.*</span><span class="sxs-lookup"><span data-stu-id="693ba-111">*Resiliency.*</span></span> <span data-ttu-id="693ba-112">¿Cómo se administran los errores de corta duración y se mantiene estable el sistema?</span><span class="sxs-lookup"><span data-stu-id="693ba-112">How do you manage short-lived failures and keep the system stable?</span></span>
- <span data-ttu-id="693ba-113">*Equilibrio de carga.*</span><span class="sxs-lookup"><span data-stu-id="693ba-113">*Load balancing.*</span></span> <span data-ttu-id="693ba-114">¿Cómo se distribuye el tráfico entrante entre varias instancias de un servicio?</span><span class="sxs-lookup"><span data-stu-id="693ba-114">How does inbound traffic get distributed across multiple instances of a service?</span></span>
- <span data-ttu-id="693ba-115">*Seguridad.*</span><span class="sxs-lookup"><span data-stu-id="693ba-115">*Security.*</span></span> <span data-ttu-id="693ba-116">¿Cómo se aplican los problemas de seguridad, como el cifrado de nivel de transporte y la administración de certificados?</span><span class="sxs-lookup"><span data-stu-id="693ba-116">How are security concerns such as transport-level encryption and certificate management enforced?</span></span>
- <span data-ttu-id="693ba-117">*Supervisión distribuida.*</span><span class="sxs-lookup"><span data-stu-id="693ba-117">*Distributed Monitoring.*</span></span> <span data-ttu-id="693ba-118">-¿Cómo se correlaciona y captura la rastreabilidad y la supervisión de una única solicitud entre varios servicios de consumo?</span><span class="sxs-lookup"><span data-stu-id="693ba-118">- How do you correlate and capture traceability and monitoring for a single request across multiple consuming services?</span></span>

<span data-ttu-id="693ba-119">Aunque estos problemas se pueden solucionar con varias bibliotecas y marcos de trabajo, implementarlos dentro de su código base puede ser costoso, complejo y llevar mucho tiempo.</span><span class="sxs-lookup"><span data-stu-id="693ba-119">While these concerns can be addressed with various libraries and frameworks, implementing them inside your codebase can be expensive, complex, and time-consuming.</span></span> <span data-ttu-id="693ba-120">Además, acaba con una solución en la que los problemas de infraestructura se acoplan a la lógica de negocios.</span><span class="sxs-lookup"><span data-stu-id="693ba-120">Moreover, you end up with a solution where infrastructure concerns are coupled to business logic.</span></span>

## <a name="service-mesh"></a><span data-ttu-id="693ba-121">Malla de servicio</span><span class="sxs-lookup"><span data-stu-id="693ba-121">Service mesh</span></span>

<span data-ttu-id="693ba-122">Un enfoque mejor es tener en cuenta una tecnología nueva y que evoluciona rápidamente titulada *malla de servicio*.</span><span class="sxs-lookup"><span data-stu-id="693ba-122">A better approach is to consider a new and rapidly evolving technology entitled *Service Mesh*.</span></span> <span data-ttu-id="693ba-123">Una [malla de servicio](https://www.nginx.com/blog/what-is-a-service-mesh/) es un nivel de infraestructura configurable con capacidades integradas para controlar la comunicación del servicio y muchos de los desafíos mencionados anteriormente.</span><span class="sxs-lookup"><span data-stu-id="693ba-123">A [service mesh](https://www.nginx.com/blog/what-is-a-service-mesh/) is a configurable infrastructure layer with built-in capabilities to handle service communication and many of the challenges mentioned above.</span></span> <span data-ttu-id="693ba-124">Desacopla estas preocupaciones del código empresarial y las mueve a un proxy de servicio, una instancia de que acompaña a cada uno de los servicios.</span><span class="sxs-lookup"><span data-stu-id="693ba-124">It decouples these concerns from your business code and moves them into a service proxy, an instance of which accompanies each of your services.</span></span> <span data-ttu-id="693ba-125">A menudo conocido como el [patrón sidecar](https://docs.microsoft.com/azure/architecture/patterns/sidecar), el proxy de la malla de servicio se implementa en un proceso independiente para proporcionar aislamiento y encapsulación del código de negocio.</span><span class="sxs-lookup"><span data-stu-id="693ba-125">Often referred to as the [Sidecar pattern](https://docs.microsoft.com/azure/architecture/patterns/sidecar), the service mesh proxy is deployed into a separate process to provide isolation and encapsulation from your business code.</span></span> <span data-ttu-id="693ba-126">Sin embargo, el proxy está estrechamente vinculado al servicio que se crea junto con él y comparte su ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="693ba-126">However, the proxy is closely linked to the service being created along with it and sharing its lifecycle.</span></span> <span data-ttu-id="693ba-127">En la figura 6-9 se muestra este escenario.</span><span class="sxs-lookup"><span data-stu-id="693ba-127">Figure 6-9 shows this scenario.</span></span>

![Malla de servicio con un coche lateral](./media/service-mesh-with-side-car.png)

<span data-ttu-id="693ba-129">**Figura 6-9**.</span><span class="sxs-lookup"><span data-stu-id="693ba-129">**Figure 6-9**.</span></span> <span data-ttu-id="693ba-130">Malla de servicio con un coche lateral</span><span class="sxs-lookup"><span data-stu-id="693ba-130">Service mesh with a side car</span></span>

<span data-ttu-id="693ba-131">En la ilustración anterior, observe cómo el proxy intercepta y administra la comunicación entre los microservicios y el clúster.</span><span class="sxs-lookup"><span data-stu-id="693ba-131">In the previous figure, note how the proxy intercepts and manages communication among the microservices and the cluster.</span></span>

<span data-ttu-id="693ba-132">Una malla de servicio se divide lógicamente en dos componentes dispares: un plano de [datos](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) y un [plano de control](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span><span class="sxs-lookup"><span data-stu-id="693ba-132">A service mesh is logically split into two disparate components: A [data plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc) and [control plane](https://blog.envoyproxy.io/service-mesh-data-plane-vs-control-plane-2774e720f7fc).</span></span> <span data-ttu-id="693ba-133">En la figura 6-10 se muestran estos componentes y sus responsabilidades.</span><span class="sxs-lookup"><span data-stu-id="693ba-133">Figure 6-10 shows these components and their responsibilities.</span></span>

![Control de malla de servicio y plano de datos](./media/istio-control-and-data-plane.png)

<span data-ttu-id="693ba-135">**Figura 6-10.**</span><span class="sxs-lookup"><span data-stu-id="693ba-135">**Figure 6-10.**</span></span> <span data-ttu-id="693ba-136">Control de malla de servicio y plano de datos</span><span class="sxs-lookup"><span data-stu-id="693ba-136">Service mesh control and data plane</span></span>

<span data-ttu-id="693ba-137">Una vez configurada, una malla de servicio es muy funcional.</span><span class="sxs-lookup"><span data-stu-id="693ba-137">Once configured, a service mesh is highly functional.</span></span> <span data-ttu-id="693ba-138">Puede recuperar un grupo correspondiente de instancias de un punto de conexión de detección de servicios.</span><span class="sxs-lookup"><span data-stu-id="693ba-138">It can retrieve a corresponding pool of instances from a service discovery endpoint.</span></span> <span data-ttu-id="693ba-139">Después, puede enviar una solicitud a una instancia específica, registrando la latencia y el tipo de respuesta del resultado.</span><span class="sxs-lookup"><span data-stu-id="693ba-139">It can then send a request to a specific instance, recording the latency and response type of the result.</span></span> <span data-ttu-id="693ba-140">Una malla puede elegir la instancia más probable de que devuelva una respuesta rápida en función de muchos factores, incluida la latencia observada para solicitudes recientes.</span><span class="sxs-lookup"><span data-stu-id="693ba-140">A mesh can choose the instance most likely to return a fast response based on many factors, including its observed latency for recent requests.</span></span>

<span data-ttu-id="693ba-141">Si una instancia no responde o se produce un error, la malla puede reintentar la solicitud en otra instancia.</span><span class="sxs-lookup"><span data-stu-id="693ba-141">If an instance is unresponsive or fails, the mesh can retry the request on another instance.</span></span> <span data-ttu-id="693ba-142">Si un grupo devuelve los errores de forma coherente, una malla puede expulsarlo del grupo de equilibrio de carga para que se vuelva a intentar periódicamente después de la reparación.</span><span class="sxs-lookup"><span data-stu-id="693ba-142">If a pool consistently returns errors, a mesh can evict it from the load-balancing pool to be retried periodically later after it heals.</span></span> <span data-ttu-id="693ba-143">Si se agota el tiempo de espera de una solicitud, se puede producir un error en una malla y volver a intentar la solicitud.</span><span class="sxs-lookup"><span data-stu-id="693ba-143">If a request times out, a mesh can fail and then retry the request.</span></span> <span data-ttu-id="693ba-144">Una malla captura el comportamiento en forma de métricas y seguimiento distribuido, que luego se puede emitir en un sistema de métricas centralizado.</span><span class="sxs-lookup"><span data-stu-id="693ba-144">A mesh captures behavior in the form of metrics and distributed tracing, which then can be emitted to a centralized metrics system.</span></span>

## <a name="istio-and-envoy"></a><span data-ttu-id="693ba-145">Istio y envío</span><span class="sxs-lookup"><span data-stu-id="693ba-145">Istio and Envoy</span></span>

<span data-ttu-id="693ba-146">Aunque actualmente existen algunas opciones de malla de servicio, [istio](https://istio.io/docs/concepts/what-is-istio/) es el más popular en el momento de redactar este documento.</span><span class="sxs-lookup"><span data-stu-id="693ba-146">While a few service mesh options currently exist, [Istio](https://istio.io/docs/concepts/what-is-istio/) is the most popular as of the time of this writing.</span></span> <span data-ttu-id="693ba-147">Una empresa conjunta de IBM, Google y Lyft, es una oferta de código abierto que se puede integrar en una aplicación distribuida nueva o existente.</span><span class="sxs-lookup"><span data-stu-id="693ba-147">A joint venture from IBM, Google, and Lyft, it's an open-source offering that can be integrated into a new or existing distributed application.</span></span> <span data-ttu-id="693ba-148">Proporciona una solución coherente y completa para proteger, conectar y supervisar microservicios.</span><span class="sxs-lookup"><span data-stu-id="693ba-148">It provides a consistent and complete solution to secure, connect, and monitor microservices.</span></span> <span data-ttu-id="693ba-149">Sus características incluyen:</span><span class="sxs-lookup"><span data-stu-id="693ba-149">Its features include:</span></span>

- <span data-ttu-id="693ba-150">Protección de la comunicación de servicio a servicio en un clúster con autenticación y autorización seguras basadas en identidades.</span><span class="sxs-lookup"><span data-stu-id="693ba-150">Secure service-to-service communication in a cluster with strong identity-based authentication and authorization.</span></span>
- <span data-ttu-id="693ba-151">Equilibrio de carga automático para el tráfico HTTP, [gRPC](https://grpc.io/), WebSocket y TCP.</span><span class="sxs-lookup"><span data-stu-id="693ba-151">Automatic load balancing for HTTP, [gRPC](https://grpc.io/), WebSocket, and TCP traffic.</span></span>
- <span data-ttu-id="693ba-152">Control específico del comportamiento del tráfico con reglas de enrutamiento enriquecidas, reintentos, conmutaciones por error e inserción de errores.</span><span class="sxs-lookup"><span data-stu-id="693ba-152">Fine-grained control of traffic behavior with rich routing rules, retries, failovers, and fault injection.</span></span>
- <span data-ttu-id="693ba-153">Un nivel de directiva acoplable y una API de configuración que admiten los controles de acceso, los límites de velocidad y las cuotas.</span><span class="sxs-lookup"><span data-stu-id="693ba-153">A pluggable policy layer and configuration API supporting access controls, rate limits, and quotas.</span></span>
- <span data-ttu-id="693ba-154">Métricas, registros y seguimientos automáticos para todo el tráfico dentro de un clúster, incluida la entrada y salida del clúster.</span><span class="sxs-lookup"><span data-stu-id="693ba-154">Automatic metrics, logs, and traces for all traffic within a cluster, including cluster ingress and egress.</span></span>

<span data-ttu-id="693ba-155">Un componente clave de una implementación de istio es un servicio de proxy titulado el [proxy de envío](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span><span class="sxs-lookup"><span data-stu-id="693ba-155">A key component for an Istio implementation is a proxy service entitled the [Envoy proxy](https://www.envoyproxy.io/docs/envoy/latest/intro/what_is_envoy).</span></span> <span data-ttu-id="693ba-156">Como origen de Lyft y, posteriormente, se ha contribuido a la [base informática nativa](https://www.cncf.io/) de la nube (descrita en el capítulo 1), el proxy de envío se ejecuta junto a cada servicio y proporciona una base independiente de la plataforma para las siguientes características:</span><span class="sxs-lookup"><span data-stu-id="693ba-156">Originating from Lyft and subsequently contributed to the [Cloud Native Computing Foundation](https://www.cncf.io/) (discussed in chapter 1), the Envoy proxy runs alongside each service and provides a platform-agnostic foundation for the following features:</span></span>

- <span data-ttu-id="693ba-157">Detección dinámica de servicios.</span><span class="sxs-lookup"><span data-stu-id="693ba-157">Dynamic service discovery.</span></span>
- <span data-ttu-id="693ba-158">Equilibrio de carga.</span><span class="sxs-lookup"><span data-stu-id="693ba-158">Load balancing.</span></span>
- <span data-ttu-id="693ba-159">Terminación de TLS.</span><span class="sxs-lookup"><span data-stu-id="693ba-159">TLS termination.</span></span>
- <span data-ttu-id="693ba-160">Proxies HTTP y gRPC.</span><span class="sxs-lookup"><span data-stu-id="693ba-160">HTTP and gRPC proxies.</span></span>
- <span data-ttu-id="693ba-161">Resistencia del disyuntor.</span><span class="sxs-lookup"><span data-stu-id="693ba-161">Circuit breaker resiliency.</span></span>
- <span data-ttu-id="693ba-162">Comprobaciones de estado.</span><span class="sxs-lookup"><span data-stu-id="693ba-162">Health checks.</span></span>
- <span data-ttu-id="693ba-163">Actualizaciones graduales con implementaciones [Canarias](https://martinfowler.com/bliki/CanaryRelease.html) .</span><span class="sxs-lookup"><span data-stu-id="693ba-163">Rolling updates with [canary](https://martinfowler.com/bliki/CanaryRelease.html) deployments.</span></span>

<span data-ttu-id="693ba-164">Como se explicó anteriormente, el envío se implementa como sidecar en cada microservicio del clúster.</span><span class="sxs-lookup"><span data-stu-id="693ba-164">As previously discussed, Envoy is deployed as a sidecar to each microservice in the cluster.</span></span>

## <a name="integration-with-azure-kubernetes-services"></a><span data-ttu-id="693ba-165">Integración con Azure Kubernetes Services</span><span class="sxs-lookup"><span data-stu-id="693ba-165">Integration with Azure Kubernetes Services</span></span>

<span data-ttu-id="693ba-166">La nube de Azure adopta istio y proporciona soporte técnico directo para ella en Azure Kubernetes Services.</span><span class="sxs-lookup"><span data-stu-id="693ba-166">The Azure cloud embraces Istio and provides direct support for it within Azure Kubernetes Services.</span></span> <span data-ttu-id="693ba-167">Los vínculos siguientes pueden ayudarle a empezar a trabajar:</span><span class="sxs-lookup"><span data-stu-id="693ba-167">The following links can help you get started:</span></span>

- [<span data-ttu-id="693ba-168">Instalación de istio en AKS</span><span class="sxs-lookup"><span data-stu-id="693ba-168">Installing Istio in AKS</span></span>](https://docs.microsoft.com/azure/aks/istio-install)
- [<span data-ttu-id="693ba-169">Usar AKS y istio</span><span class="sxs-lookup"><span data-stu-id="693ba-169">Using AKS and Istio</span></span>](https://docs.microsoft.com/azure/aks/istio-scenario-routing)

>[!div class="step-by-step"]
><span data-ttu-id="693ba-170">[Anterior](infrastructure-resiliency-azure.md)
>[Siguiente](monitoring-health.md)</span><span class="sxs-lookup"><span data-stu-id="693ba-170">[Previous](infrastructure-resiliency-azure.md)
[Next](monitoring-health.md)</span></span>
