---
title: Operaciones de servicio (Servicios de datos de WCF)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- service operations [WCF Data Services]
- WCF Data Services, service operations
ms.assetid: 583a690a-e60f-4990-8991-d6efce069d76
ms.openlocfilehash: c254a7362c7bc28f4b38fc0189ae0ea763bc90cc
ms.sourcegitcommit: 79a2d6a07ba4ed08979819666a0ee6927bbf1b01
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 11/28/2019
ms.locfileid: "74568844"
---
# <a name="service-operations-wcf-data-services"></a><span data-ttu-id="fbd77-102">Operaciones de servicio (Servicios de datos de WCF)</span><span class="sxs-lookup"><span data-stu-id="fbd77-102">Service Operations (WCF Data Services)</span></span>

<span data-ttu-id="fbd77-103">WCF Data Services permite definir operaciones de servicio en un servicio de datos para exponer métodos en el servidor.</span><span class="sxs-lookup"><span data-stu-id="fbd77-103">WCF Data Services enables you to define service operations on a data service to expose methods on the server.</span></span> <span data-ttu-id="fbd77-104">Las operaciones de servicio se direccionan como los demás recursos del servicio de datos, mediante los URI.</span><span class="sxs-lookup"><span data-stu-id="fbd77-104">Like other data service resources, service operations are addressed by URIs.</span></span> <span data-ttu-id="fbd77-105">Las operaciones de servicio le permiten exponer la lógica de negocios de un servicio de datos; por ejemplo, implementar la lógica de validación, aplicar la seguridad basada en roles o exponer capacidades de consulta especializadas.</span><span class="sxs-lookup"><span data-stu-id="fbd77-105">Service operations enable you to expose business logic in a data service, such as to implement validation logic, to apply role-based security, or to expose specialized querying capabilities.</span></span> <span data-ttu-id="fbd77-106">Estas operaciones son métodos agregados a la clase del servicio de datos derivada de <xref:System.Data.Services.DataService%601>.</span><span class="sxs-lookup"><span data-stu-id="fbd77-106">Service operations are methods added to the data service class that derives from <xref:System.Data.Services.DataService%601>.</span></span> <span data-ttu-id="fbd77-107">Como el resto de los recursos del servicio de datos, puede proporcionar parámetros al método de operación de servicio.</span><span class="sxs-lookup"><span data-stu-id="fbd77-107">Like all other data service resources, you can supply parameters to the service operation method.</span></span> <span data-ttu-id="fbd77-108">Por ejemplo, el siguiente URI de operación de servicio (basado en el servicio de datos de [Inicio rápido](quickstart-wcf-data-services.md) ) pasa el valor `London` al parámetro `city`:</span><span class="sxs-lookup"><span data-stu-id="fbd77-108">For example, the following service operation URI (based on the [quickstart](quickstart-wcf-data-services.md) data service) passes the value `London` to the `city` parameter:</span></span>

```http
http://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'
```

<span data-ttu-id="fbd77-109">La definición de esta operación de servicio es la siguiente:</span><span class="sxs-lookup"><span data-stu-id="fbd77-109">The definition for this service operation is as follows:</span></span>

[!code-csharp[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind2.svc.cs#serviceoperationdef)]
[!code-vb[Astoria Northwind Service#ServiceOperationDef](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind2.svc.vb#serviceoperationdef)]

<span data-ttu-id="fbd77-110">Puede usar la propiedad <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> de la clase <xref:System.Data.Services.DataService%601> para tener acceso directo al origen de datos que está usando el servicio de datos.</span><span class="sxs-lookup"><span data-stu-id="fbd77-110">You can use the <xref:System.Data.Services.DataService%601.CurrentDataSource%2A> of the <xref:System.Data.Services.DataService%601> to directly access the data source that the data service is using.</span></span> <span data-ttu-id="fbd77-111">Para obtener más información, consulte [Cómo: definir una operación de servicio](how-to-define-a-service-operation-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="fbd77-111">For more information, see [How to: Define a Service Operation](how-to-define-a-service-operation-wcf-data-services.md).</span></span>

<span data-ttu-id="fbd77-112">Para obtener información sobre cómo llamar a una operación de servicio desde una .NET Framework aplicación cliente, vea [llamar a operaciones de servicio](calling-service-operations-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="fbd77-112">For information on how to call a service operation from a .NET Framework client application, see [Calling Service Operations](calling-service-operations-wcf-data-services.md).</span></span>

## <a name="service-operation-requirements"></a><span data-ttu-id="fbd77-113">Requisitos que deben cumplir las operaciones de servicio</span><span class="sxs-lookup"><span data-stu-id="fbd77-113">Service Operation Requirements</span></span>

<span data-ttu-id="fbd77-114">Al definir operaciones de servicio en el servicio de datos deben tenerse en cuenta los requisitos siguientes.</span><span class="sxs-lookup"><span data-stu-id="fbd77-114">The following requirements apply when defining service operations on the data service.</span></span> <span data-ttu-id="fbd77-115">Si un método no los cumple, no se expondrá como operación de servicio para el servicio de datos.</span><span class="sxs-lookup"><span data-stu-id="fbd77-115">If a method does not meet these requirements, it will not be exposed as a service operation for the data service.</span></span>

- <span data-ttu-id="fbd77-116">La operación debe ser un método de instancia pública que sea miembro de la clase del servicio de datos.</span><span class="sxs-lookup"><span data-stu-id="fbd77-116">The operation must be a public instance method that is a member of the data service class.</span></span>

- <span data-ttu-id="fbd77-117">El método de la operación solo puede aceptar parámetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="fbd77-117">The operation method may only accept input parameters.</span></span> <span data-ttu-id="fbd77-118">El servicio de datos no puede tener acceso a los datos enviados en el cuerpo del mensaje.</span><span class="sxs-lookup"><span data-stu-id="fbd77-118">Data sent in the message body cannot be accessed by the data service.</span></span>

- <span data-ttu-id="fbd77-119">Si se definen parámetros, el tipo de cada parámetro debe ser un tipo primitivo.</span><span class="sxs-lookup"><span data-stu-id="fbd77-119">If parameters are defined, the type of each parameter must be a primitive type.</span></span> <span data-ttu-id="fbd77-120">Cualquier dato de un tipo no primitivo se debe serializar y pasar a un parámetro de cadena.</span><span class="sxs-lookup"><span data-stu-id="fbd77-120">Any data of a non-primitive type must be serialized and passed into a string parameter.</span></span>

- <span data-ttu-id="fbd77-121">El método debe devolver uno de los elementos siguientes:</span><span class="sxs-lookup"><span data-stu-id="fbd77-121">The method must return one of the following:</span></span>

  - <span data-ttu-id="fbd77-122">`void` (`Nothing` en Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="fbd77-122">`void` (`Nothing` in Visual Basic)</span></span>

  - <xref:System.Collections.Generic.IEnumerable%601>

  - <xref:System.Linq.IQueryable%601>

  - <span data-ttu-id="fbd77-123">Un tipo de entidad en el modelo de datos expuesto por el servicio de datos.</span><span class="sxs-lookup"><span data-stu-id="fbd77-123">An entity type in the data model that the data service exposes.</span></span>

  - <span data-ttu-id="fbd77-124">Una clase primitiva como entero o cadena.</span><span class="sxs-lookup"><span data-stu-id="fbd77-124">A primitive class such as integer or string.</span></span>

- <span data-ttu-id="fbd77-125">Para admitir opciones de consulta como ordenaciones, paginaciones y filtrados, los métodos de las operaciones de servicio deben devolver <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="fbd77-125">In order to support query options such as sorting, paging, and filtering, service operation methods should return <xref:System.Linq.IQueryable%601>.</span></span> <span data-ttu-id="fbd77-126">Las solicitudes a operaciones de servicio que incluyen opciones de consulta se rechazan para las operaciones que solo devuelven <xref:System.Collections.Generic.IEnumerable%601>.</span><span class="sxs-lookup"><span data-stu-id="fbd77-126">Requests to service operations that include query options are rejected for operations that only return <xref:System.Collections.Generic.IEnumerable%601>.</span></span>

- <span data-ttu-id="fbd77-127">Para que se pueda tener acceso a las entidades relacionadas usando las propiedades de navegación, la operación de servicio debe devolver <xref:System.Linq.IQueryable%601>.</span><span class="sxs-lookup"><span data-stu-id="fbd77-127">In order to support accessing related entities by using navigation properties, the service operation must return <xref:System.Linq.IQueryable%601>.</span></span>

- <span data-ttu-id="fbd77-128">El método se debe anotar con el atributo `[WebGet]` o `[WebInvoke]`.</span><span class="sxs-lookup"><span data-stu-id="fbd77-128">The method must be annotated with the `[WebGet]` or `[WebInvoke]` attribute.</span></span>

  - <span data-ttu-id="fbd77-129">`[WebGet]` permite invocar el método usando una solicitud GET.</span><span class="sxs-lookup"><span data-stu-id="fbd77-129">`[WebGet]` enables the method to be invoked by using a GET request.</span></span>

  - <span data-ttu-id="fbd77-130">`[WebInvoke(Method = "POST")]` permite invocar el método usando una solicitud POST.</span><span class="sxs-lookup"><span data-stu-id="fbd77-130">`[WebInvoke(Method = "POST")]` enables the method to be invoked by using a POST request.</span></span> <span data-ttu-id="fbd77-131">No se admiten otros métodos <xref:System.ServiceModel.Web.WebInvokeAttribute>.</span><span class="sxs-lookup"><span data-stu-id="fbd77-131">Other <xref:System.ServiceModel.Web.WebInvokeAttribute> methods are not supported.</span></span>

- <span data-ttu-id="fbd77-132">Una operación de servicio se puede anotar con el elemento <xref:System.Data.Services.SingleResultAttribute> que especifica que el valor devuelto desde el método es una sola entidad en vez de una colección de entidades.</span><span class="sxs-lookup"><span data-stu-id="fbd77-132">A service operation may be annotated with the <xref:System.Data.Services.SingleResultAttribute> that specifies that the return value from the method is a single entity rather than a collection of entities.</span></span> <span data-ttu-id="fbd77-133">Esta distinción dicta la serialización resultante de la respuesta y la manera en que se representan en el URI los recorridos de las propiedades de navegación adicionales.</span><span class="sxs-lookup"><span data-stu-id="fbd77-133">This distinction dictates the resulting serialization of the response and the manner in which additional navigation property traversals are represented in the URI.</span></span> <span data-ttu-id="fbd77-134">Por ejemplo, cuando use la serialización AtomPub, una sola instancia de tipo de recurso se representa como elemento de entrada y un conjunto de instancias como elemento feed.</span><span class="sxs-lookup"><span data-stu-id="fbd77-134">For example, when using AtomPub serialization, a single resource type instance is represented as an entry element and a set of instances as a feed element.</span></span>

## <a name="addressing-service-operations"></a><span data-ttu-id="fbd77-135">Direccionamiento de las operaciones de servicio</span><span class="sxs-lookup"><span data-stu-id="fbd77-135">Addressing Service Operations</span></span>

<span data-ttu-id="fbd77-136">Puede direccionar las operaciones de servicio colocando el nombre del método en el primer segmento de la ruta de acceso de un URI.</span><span class="sxs-lookup"><span data-stu-id="fbd77-136">You can address service operations by placing the name of the method in the first path segment of a URI.</span></span> <span data-ttu-id="fbd77-137">Como ejemplo, el siguiente URI tiene acceso a una operación `GetOrdersByState` que devuelve una colección <xref:System.Linq.IQueryable%601> de objetos `Orders`.</span><span class="sxs-lookup"><span data-stu-id="fbd77-137">As an example, the following URI accesses a `GetOrdersByState` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects.</span></span>

```http
http://localhost:12345/Northwind.svc/GetOrdersByState?state='CA'&includeItems=true
```

<span data-ttu-id="fbd77-138">Al llamar a una operación de servicio, los parámetros se proporcionan como opciones de consulta.</span><span class="sxs-lookup"><span data-stu-id="fbd77-138">When calling a service operation, parameters are supplied as query options.</span></span> <span data-ttu-id="fbd77-139">La operación de servicio anterior acepta tanto un parámetro de cadena `state` como un parámetro booleano `includeItems` que indica si se van a incluir objetos `Order_Detail` relacionados en la respuesta.</span><span class="sxs-lookup"><span data-stu-id="fbd77-139">The previous service operation accepts both a string parameter `state` and a Boolean parameter `includeItems` that indicates whether to include related `Order_Detail` objects in the response.</span></span>

<span data-ttu-id="fbd77-140">A continuación se enumeran los tipos de valor devueltos válidos para una operación de servicio:</span><span class="sxs-lookup"><span data-stu-id="fbd77-140">The following are valid return types for a service operation:</span></span>

|<span data-ttu-id="fbd77-141">Tipos de valor devueltos válidos</span><span class="sxs-lookup"><span data-stu-id="fbd77-141">Valid Return Types</span></span>|<span data-ttu-id="fbd77-142">Reglas que deben cumplir los URI</span><span class="sxs-lookup"><span data-stu-id="fbd77-142">URI Rules</span></span>|
|------------------------|---------------|
|<span data-ttu-id="fbd77-143">`void` (`Nothing` en Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="fbd77-143">`void` (`Nothing` in Visual Basic)</span></span><br /><br /> <span data-ttu-id="fbd77-144">O bien,</span><span class="sxs-lookup"><span data-stu-id="fbd77-144">-or-</span></span><br /><br /> <span data-ttu-id="fbd77-145">Tipos de entidad</span><span class="sxs-lookup"><span data-stu-id="fbd77-145">Entity types</span></span><br /><br /> <span data-ttu-id="fbd77-146">O bien,</span><span class="sxs-lookup"><span data-stu-id="fbd77-146">-or-</span></span><br /><br /> <span data-ttu-id="fbd77-147">Tipos primitivos</span><span class="sxs-lookup"><span data-stu-id="fbd77-147">Primitive types</span></span>|<span data-ttu-id="fbd77-148">El URI debe ser un solo segmento de ruta de acceso que sea el nombre de la operación de servicio.</span><span class="sxs-lookup"><span data-stu-id="fbd77-148">The URI must be a single path segment that is the name of the service operation.</span></span> <span data-ttu-id="fbd77-149">No se permiten las opciones de consulta.</span><span class="sxs-lookup"><span data-stu-id="fbd77-149">Query options are not allowed.</span></span>|
|<xref:System.Collections.Generic.IEnumerable%601>|<span data-ttu-id="fbd77-150">El URI debe ser un solo segmento de ruta de acceso que sea el nombre de la operación de servicio.</span><span class="sxs-lookup"><span data-stu-id="fbd77-150">The URI must be a single path segment that is the name of the service operation.</span></span> <span data-ttu-id="fbd77-151">Puesto que el tipo de resultado no es un tipo <xref:System.Linq.IQueryable%601>, no se permiten las opciones de consulta.</span><span class="sxs-lookup"><span data-stu-id="fbd77-151">Because the result type is not an <xref:System.Linq.IQueryable%601> type, query options are not allowed.</span></span>|
|<xref:System.Linq.IQueryable%601>|<span data-ttu-id="fbd77-152">Se permiten segmentos de ruta de acceso de la consulta además de la ruta de acceso que es el nombre de la operación de servicio.</span><span class="sxs-lookup"><span data-stu-id="fbd77-152">Query path segments in addition to the path that is the name of the service operation are allowed.</span></span> <span data-ttu-id="fbd77-153">También se permiten las opciones de consulta.</span><span class="sxs-lookup"><span data-stu-id="fbd77-153">Query options are also allowed.</span></span>|

<span data-ttu-id="fbd77-154">Se pueden agregar segmentos de ruta de acceso u opciones de consulta adicionales al URI en función del tipo de valor devuelto de la operación de servicio.</span><span class="sxs-lookup"><span data-stu-id="fbd77-154">Additional path segments or query options may be added to the URI depending on the return type of the service operation.</span></span> <span data-ttu-id="fbd77-155">Por ejemplo, el URI siguiente tiene acceso a una operación `GetOrdersByCity` que devuelve una colección <xref:System.Linq.IQueryable%601> de objetos `Orders`, ordenada en orden descendente por `RequiredDate`, junto con los objetos `Order_Details` relacionados:</span><span class="sxs-lookup"><span data-stu-id="fbd77-155">For example, the following URI accesses a `GetOrdersByCity` operation that returns an <xref:System.Linq.IQueryable%601> collection of `Orders` objects, ordered by `RequiredDate` in descending order, along with the related `Order_Details` objects:</span></span>

```http
http://localhost:12345/Northwind.svc/GetOrdersByCity?city='London'&$expand=Order_Details&$orderby=RequiredDate desc
```

## <a name="service-operations-access-control"></a><span data-ttu-id="fbd77-156">Control de acceso a las operaciones de servicio</span><span class="sxs-lookup"><span data-stu-id="fbd77-156">Service Operations Access Control</span></span>

<span data-ttu-id="fbd77-157">El método <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> de la clase <xref:System.Data.Services.IDataServiceConfiguration> controla la visibilidad en el ámbito de todos los servicios de las operaciones de servicio, de la misma forma que el método <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A> controla la visibilidad del conjunto de entidades.</span><span class="sxs-lookup"><span data-stu-id="fbd77-157">Service-wide visibility of service operations is controlled by the <xref:System.Data.Services.IDataServiceConfiguration.SetServiceOperationAccessRule%2A> method on the <xref:System.Data.Services.IDataServiceConfiguration> class in much the same way that entity set visibility is controlled by using the <xref:System.Data.Services.IDataServiceConfiguration.SetEntitySetAccessRule%2A> method.</span></span> <span data-ttu-id="fbd77-158">Por ejemplo, la línea de código siguiente de la definición del servicio de datos permite el acceso a la operación de servicio `CustomersByCity`.</span><span class="sxs-lookup"><span data-stu-id="fbd77-158">For example, the following line of code in the data service definition enables access to the `CustomersByCity` service operation.</span></span>

[!code-csharp[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind2.svc.cs#serviceoperationconfig)]
[!code-vb[Astoria Northwind Service#ServiceOperationConfig](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind2.svc.vb#serviceoperationconfig)]

> [!NOTE]
> <span data-ttu-id="fbd77-159">Si una operación de servicio tiene un tipo de valor devuelto que se oculta restringiendo el acceso en los conjuntos de entidades subyacentes, la operación de servicio no estará disponible para las aplicaciones cliente.</span><span class="sxs-lookup"><span data-stu-id="fbd77-159">If a service operation has a return type that has been hidden by restricting access on the underlying entity sets, then the service operation will not be available to client applications.</span></span>

<span data-ttu-id="fbd77-160">Para obtener más información, consulte [Cómo: definir una operación de servicio](how-to-define-a-service-operation-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="fbd77-160">For more information, see [How to: Define a Service Operation](how-to-define-a-service-operation-wcf-data-services.md).</span></span>

## <a name="raising-exceptions"></a><span data-ttu-id="fbd77-161">Producir excepciones</span><span class="sxs-lookup"><span data-stu-id="fbd77-161">Raising Exceptions</span></span>

<span data-ttu-id="fbd77-162">Recomendamos usar la clase <xref:System.Data.Services.DataServiceException> cada vez que produzca una excepción en la ejecución del servicio de datos.</span><span class="sxs-lookup"><span data-stu-id="fbd77-162">We recommend that you use the <xref:System.Data.Services.DataServiceException> class whenever you raise an exception in the data service execution.</span></span> <span data-ttu-id="fbd77-163">Esto es porque el tiempo de ejecución del servicio de datos sabe cómo asignar correctamente propiedades de este objeto de excepción al mensaje de respuesta HTTP.</span><span class="sxs-lookup"><span data-stu-id="fbd77-163">This is because the data service runtime knows how to map properties of this exception object correctly to the HTTP response message.</span></span> <span data-ttu-id="fbd77-164">Al generar una <xref:System.Data.Services.DataServiceException> en una operación de servicio, la excepción devuelta está contenida en <xref:System.Reflection.TargetInvocationException>.</span><span class="sxs-lookup"><span data-stu-id="fbd77-164">When you raise a <xref:System.Data.Services.DataServiceException> in a service operation, the returned exception is wrapped in a <xref:System.Reflection.TargetInvocationException>.</span></span> <span data-ttu-id="fbd77-165">Para devolver la <xref:System.Data.Services.DataServiceException> base sin la <xref:System.Reflection.TargetInvocationException> envolvente, debe invalidar el método <xref:System.Data.Services.DataService%601.HandleException%2A> en <xref:System.Data.Services.DataService%601>, extraer <xref:System.Data.Services.DataServiceException> de <xref:System.Reflection.TargetInvocationException> y devolverlo como el error de nivel superior, como en el siguiente ejemplo:</span><span class="sxs-lookup"><span data-stu-id="fbd77-165">To return the base <xref:System.Data.Services.DataServiceException> without the enclosing <xref:System.Reflection.TargetInvocationException>, you must override the <xref:System.Data.Services.DataService%601.HandleException%2A> method in the <xref:System.Data.Services.DataService%601>, extract the <xref:System.Data.Services.DataServiceException> from the <xref:System.Reflection.TargetInvocationException>, and return it as the top-level error, as in the following example:</span></span>

[!code-csharp[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_service/cs/northwind2.svc.cs#handleexceptions)]
[!code-vb[Astoria Northwind Service#HandleExceptions](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_service/vb/northwind2.svc.vb#handleexceptions)]

## <a name="see-also"></a><span data-ttu-id="fbd77-166">Vea también</span><span class="sxs-lookup"><span data-stu-id="fbd77-166">See also</span></span>

- [<span data-ttu-id="fbd77-167">Interceptores</span><span class="sxs-lookup"><span data-stu-id="fbd77-167">Interceptors</span></span>](interceptors-wcf-data-services.md)
